 9
:D:\MS-casestudy\Api\CartApi\Controllers\CartsController.cs
	namespace 	
CartApi
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
CartsController  
:! "
ControllerBase# 1
{ 
private 
readonly 
CartApiContext '
_context( 0
;0 1
public 
CartsController 
( 
CartApiContext -
context. 5
)5 6
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
Cart3 7
>7 8
>8 9
>9 :
GetCart; B
(B C
)C D
{ 	
if
 
( 
_context 
. 
Cart 
== 
null #
)# $
{
 
return 
NotFound 
( 
) 
;  
}
 
return   
await   
_context   !
.  ! "
Cart  " &
.  & '
ToListAsync  ' 2
(  2 3
)  3 4
;  4 5
}!! 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
ActionResult%% &
<%%& '
Cart%%' +
>%%+ ,
>%%, -
GetCart%%. 5
(%%5 6
int%%6 9
id%%: <
)%%< =
{&& 	
if''
 
('' 
_context'' 
.'' 
Cart'' 
=='' 
null'' #
)''# $
{((
 
return)) 
NotFound)) 
()) 
))) 
;))  
}**
 
var++ 
cart++ 
=++ 
await++ 
_context++ %
.++% &
Cart++& *
.++* +
	FindAsync+++ 4
(++4 5
id++5 7
)++7 8
;++8 9
if-- 
(-- 
cart-- 
==-- 
null-- 
)-- 
{.. 
return// 
NotFound// 
(//  
)//  !
;//! "
}00 
return22 
cart22 
;22 
}33 	
[77 	
HttpPut77	 
(77 
$str77 
)77 
]77 
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
PutCart88) 0
(880 1
int881 4
id885 7
,887 8
Cart889 =
cart88> B
)88B C
{99 	
if:: 
(:: 
id:: 
!=:: 
cart:: 
.:: 
Id:: 
):: 
{;; 
return<< 

BadRequest<< !
(<<! "
)<<" #
;<<# $
}== 
_context?? 
.?? 
Entry?? 
(?? 
cart?? 
)??  
.??  !
State??! &
=??' (
EntityState??) 4
.??4 5
Modified??5 =
;??= >
tryAA 
{BB 
awaitCC 
_contextCC 
.CC 
SaveChangesAsyncCC /
(CC/ 0
)CC0 1
;CC1 2
}DD 
catchEE 
(EE (
DbUpdateConcurrencyExceptionEE /
)EE/ 0
{FF 
ifGG 
(GG 
!GG 

CartExistsGG 
(GG  
idGG  "
)GG" #
)GG# $
{HH 
returnII 
NotFoundII #
(II# $
)II$ %
;II% &
}JJ 
elseKK 
{LL 
throwMM 
;MM 
}NN 
}OO 
returnQQ 
	NoContentQQ 
(QQ 
)QQ 
;QQ 
}RR 	
[VV 	
HttpPostVV	 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
ActionResultWW &
<WW& '
CartWW' +
>WW+ ,
>WW, -
PostCartWW. 6
(WW6 7
CartWW7 ;
cartWW< @
)WW@ A
{XX 	
ifYY
 
(YY 
_contextYY 
.YY 
CartYY 
==YY 
nullYY #
)YY# $
{ZZ
 
return[[ 
Problem[[ 
([[ 
$str[[ I
)[[I J
;[[J K
}\\
 
_context]] 
.]] 
Cart]] 
.]] 
Add]] 
(]] 
cart]] "
)]]" #
;]]# $
await^^ 
_context^^ 
.^^ 
SaveChangesAsync^^ +
(^^+ ,
)^^, -
;^^- .
return`` 
CreatedAtAction`` "
(``" #
$str``# ,
,``, -
new``. 1
{``2 3
id``4 6
=``7 8
cart``9 =
.``= >
Id``> @
}``A B
,``B C
cart``D H
)``H I
;``I J
}aa 	
[dd 	

HttpDeletedd	 
(dd 
$strdd 
)dd 
]dd 
publicee 
asyncee 
Taskee 
<ee 
IActionResultee '
>ee' (

DeleteCartee) 3
(ee3 4
intee4 7
idee8 :
)ee: ;
{ff 	
ifgg 
(gg 
_contextgg 
.gg 
Cartgg 
==gg  
nullgg! %
)gg% &
{hh 
returnii 
NotFoundii 
(ii  
)ii  !
;ii! "
}jj 
varkk 
cartkk 
=kk 
awaitkk 
_contextkk %
.kk% &
Cartkk& *
.kk* +
	FindAsynckk+ 4
(kk4 5
idkk5 7
)kk7 8
;kk8 9
ifll 
(ll 
cartll 
==ll 
nullll 
)ll 
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
_contextqq 
.qq 
Cartqq 
.qq 
Removeqq  
(qq  !
cartqq! %
)qq% &
;qq& '
awaitrr 
_contextrr 
.rr 
SaveChangesAsyncrr +
(rr+ ,
)rr, -
;rr- .
returntt 
	NoContenttt 
(tt 
)tt 
;tt 
}uu 	
privateww 
boolww 

CartExistsww 
(ww  
intww  #
idww$ &
)ww& '
{xx 	
returnyy 
(yy 
_contextyy 
.yy 
Cartyy !
?yy! "
.yy" #
Anyyy# &
(yy& '
eyy' (
=>yy) +
eyy, -
.yy- .
Idyy. 0
==yy1 3
idyy4 6
)yy6 7
)yy7 8
.yy8 9
GetValueOrDefaultyy9 J
(yyJ K
)yyK L
;yyL M
}zz 	
}{{ 
}|| ù
2D:\MS-casestudy\Api\CartApi\Data\CartApiContext.cs
	namespace 	
CartApi
 
. 
Data 
{		 
public

 

class

 
CartApiContext

 
:

  !
	DbContext

" +
{ 
public 
CartApiContext 
( 
DbContextOptions /
</ 0
CartApiContext0 >
>> ?
options@ G
)G H
: 
base 
( 
options 
) 
{ 	
} 	
public 
DbSet 
< 
CartApi 
. 
Models #
.# $
Cart$ (
>( )
Cart* .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >
default? F
!F G
;G H
} 
} «
AD:\MS-casestudy\Api\CartApi\Migrations\20220816120505_initial1.cs
	namespace 	
CartApi
 
. 

Migrations 
{ 
public 

partial 
class 
initial1 !
:" #
	Migration$ -
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
	ProductId 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
ProductName 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= L
,L M
nullableN V
:V W
falseX ]
)] ^
,^ _
Qty 
= 
table 
.  
Column  &
<& '
int' *
>* +
(+ ,
type, 0
:0 1
$str2 7
,7 8
nullable9 A
:A B
falseC H
)H I
,I J
Price 
= 
table !
.! "
Column" (
<( )
int) ,
>, -
(- .
type. 2
:2 3
$str4 9
,9 :
nullable; C
:C D
falseE J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% .
,. /
x0 1
=>2 4
x5 6
.6 7
Id7 9
)9 :
;: ;
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
; 
}   	
}!! 
}"" ‡
*D:\MS-casestudy\Api\CartApi\Models\Cart.cs
	namespace 	
CartApi
 
. 
Models 
{ 
public 

class 
Cart 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
	ProductId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
ProductName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
Qty 
{ 
get 
; 
set !
;! "
}# $
public		 
int		 
Price		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
}

 
} å
&D:\MS-casestudy\Api\CartApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddDbContext 
< 
CartApiContext ,
>, -
(- .
options. 5
=>6 8
options 
. 
UseSqlServer 
( 
builder  
.  !
Configuration! .
.. /
GetConnectionString/ B
(B C
$strC S
)S T
??U W
throwX ]
new^ a%
InvalidOperationExceptionb {
({ |
$str	| ´
)
´ ¨
)
¨ ≠
)
≠ Æ
;
Æ Ø
builder

 
.

 
Services

 
.

 
AddControllers

 
(

  
)

  !
;

! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
builder 
. 
Services 
. 
AddCors 
( 
option 
=>  "
{ 
option 

.
 
AddDefaultPolicy 
( 
builder #
=>$ &
{ 
builder 
. 
AllowAnyOrigin 
( 
)  
.  !
AllowAnyHeader! /
(/ 0
)0 1
.1 2
AllowAnyMethod2 @
(@ A
)A B
;B C
} 
) 
; 
} 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app 
. 

UseSwagger 
( 
) 
; 
app 
. 
UseSwaggerUI 
( 
) 
; 
} 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app   
.   
UseCors   
(   
)   
;   
app!! 
.!! 
UseAuthorization!! 
(!! 
)!! 
;!! 
app## 
.## 
MapControllers## 
(## 
)## 
;## 
app%% 
.%% 
Run%% 
(%% 
)%% 	
;%%	 
